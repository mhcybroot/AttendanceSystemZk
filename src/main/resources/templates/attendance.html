<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Attendance Logs</title>
</head>

<body>
    <div th:replace="~{layout :: layout(~{::section}, ~{}, 'attendance')}">
        <section>
            <div class="container-fluid">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>Attendance Logs</h2>
                    <form action="/attendance" method="get" class="d-flex">
                        <select name="departmentId" class="form-select me-2">
                            <option value="">All Departments</option>
                            <option th:each="dept : ${departments}" th:value="${dept.id}" th:text="${dept.name}"
                                th:selected="${selectedDeptId == dept.id}">
                            </option>
                        </select>
                        <button type="submit" class="btn btn-outline-primary">Filter</button>
                    </form>
                </div>

                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0 align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th>
                                            <a class="text-dark fw-bold text-decoration-none"
                                                th:href="@{/attendance(departmentId=${selectedDeptId}, sortField='id', sortDir=${sortField == 'id' ? reverseSortDir : sortDir})}">
                                                Log ID
                                                <span th:if="${sortField == 'id'}"
                                                    th:text="${sortDir == 'asc' ? '▲' : '▼'}"></span>
                                            </a>
                                        </th>
                                        <th>
                                            <a class="text-dark fw-bold text-decoration-none"
                                                th:href="@{/attendance(departmentId=${selectedDeptId}, sortField='employeeName', sortDir=${sortField == 'employeeName' ? reverseSortDir : sortDir})}">
                                                Employee Name
                                                <span th:if="${sortField == 'employeeName'}"
                                                    th:text="${sortDir == 'asc' ? '▲' : '▼'}"></span>
                                            </a>
                                        </th>
                                        <th>
                                            <a class="text-dark fw-bold text-decoration-none"
                                                th:href="@{/attendance(departmentId=${selectedDeptId}, sortField='employeeId', sortDir=${sortField == 'employeeId' ? reverseSortDir : sortDir})}">
                                                Employee ID
                                                <span th:if="${sortField == 'employeeId'}"
                                                    th:text="${sortDir == 'asc' ? '▲' : '▼'}"></span>
                                            </a>
                                        </th>
                                        <th>
                                            <a class="text-dark fw-bold text-decoration-none"
                                                th:href="@{/attendance(departmentId=${selectedDeptId}, sortField='deviceId', sortDir=${sortField == 'deviceId' ? reverseSortDir : sortDir})}">
                                                Device ID
                                                <span th:if="${sortField == 'deviceId'}"
                                                    th:text="${sortDir == 'asc' ? '▲' : '▼'}"></span>
                                            </a>
                                        </th>
                                        <th>
                                            <a class="text-dark fw-bold text-decoration-none"
                                                th:href="@{/attendance(departmentId=${selectedDeptId}, sortField='timestamp', sortDir=${sortField == 'timestamp' ? reverseSortDir : sortDir})}">
                                                Timestamp
                                                <span th:if="${sortField == 'timestamp'}"
                                                    th:text="${sortDir == 'asc' ? '▲' : '▼'}"></span>
                                            </a>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="log : ${logs}">
                                        <td th:text="${log.id}">1</td>
                                        <td th:text="${employeeMap.getOrDefault(log.employeeId, 'Unknown')}">John Doe
                                        </td>
                                        <td th:text="${log.employeeId}">101</td>
                                        <td th:text="${log.deviceId}">1</td>
                                        <td th:text="${#temporals.format(log.timestamp, 'yyyy-MM-dd HH:mm:ss')}">
                                            2023-10-01
                                            08:30:00
                                        </td>
                                    </tr>
                                    <tr th:if="${#lists.isEmpty(logs)}">
                                        <td colspan="5" class="text-center">No logs found.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div th:replace="~{fragments/pagination :: pagination(page=${page}, baseUrl='/attendance')}"></div>
                </div>
            </div>
        </section>
    </div>
</body>

</html>