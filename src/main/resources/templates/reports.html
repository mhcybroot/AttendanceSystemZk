<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Daily Reports - Attendance System</title>
</head>

<body>
    <div th:replace="~{layout :: layout(~{::section}, ~{}, 'reports')}">
        <section>
            <style>
                .badge-ABSENT {
                    background-color: #dc3545;
                }

                .badge-LATE {
                    background-color: #ffc107;
                    color: black;
                }

                .badge-EARLY {
                    background-color: #0dcaf0;
                    color: black;
                }

                .badge-PRESENT {
                    background-color: #198754;
                }
            </style>

            <div class="container-fluid px-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Daily Attendance Report</h2>
                    <form action="/reports" method="get" class="d-flex align-items-center">
                        <select name="departmentId" class="form-select me-2" style="width: auto;">
                            <option value="">All Departments</option>
                            <option th:each="dept : ${departments}" th:value="${dept.id}" th:text="${dept.name}"
                                th:selected="${dept.id == selectedDeptId}"></option>
                        </select>
                        <input type="date" name="date" class="form-control me-2" style="width: auto;"
                            th:value="${date}">
                        <button type="submit" class="btn btn-primary">View Report</button>
                        <a th:href="@{/reports/daily/pdf(date=${date}, departmentId=${selectedDeptId})}"
                            class="btn btn-dark ms-2">Download PDF</a>
                    </form>
                </div>

                <div class="card shadow-sm">
                    <div class="card-body">
                        <table class="table table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>
                                        <a class="text-white text-decoration-none"
                                            th:href="@{/reports(date=${date}, departmentId=${selectedDeptId}, sortField='name', sortDir=${sortField == 'name' ? reverseSortDir : sortDir})}">
                                            Name <span th:if="${sortField == 'name'}"
                                                th:text="${sortDir == 'asc' ? '▲' : '▼'}"></span>
                                        </a>
                                    </th>
                                    <th>
                                        <a class="text-white text-decoration-none"
                                            th:href="@{/reports(date=${date}, departmentId=${selectedDeptId}, sortField='department', sortDir=${sortField == 'department' ? reverseSortDir : sortDir})}">
                                            Department <span th:if="${sortField == 'department'}"
                                                th:text="${sortDir == 'asc' ? '▲' : '▼'}"></span>
                                        </a>
                                    </th>
                                    <th>
                                        <a class="text-white text-decoration-none"
                                            th:href="@{/reports(date=${date}, departmentId=${selectedDeptId}, sortField='inTime', sortDir=${sortField == 'inTime' ? reverseSortDir : sortDir})}">
                                            In Time <span th:if="${sortField == 'inTime'}"
                                                th:text="${sortDir == 'asc' ? '▲' : '▼'}"></span>
                                        </a>
                                    </th>
                                    <th>
                                        <a class="text-white text-decoration-none"
                                            th:href="@{/reports(date=${date}, departmentId=${selectedDeptId}, sortField='outTime', sortDir=${sortField == 'outTime' ? reverseSortDir : sortDir})}">
                                            Out Time <span th:if="${sortField == 'outTime'}"
                                                th:text="${sortDir == 'asc' ? '▲' : '▼'}"></span>
                                        </a>
                                    </th>
                                    <th>
                                        <a class="text-white text-decoration-none"
                                            th:href="@{/reports(date=${date}, departmentId=${selectedDeptId}, sortField='status', sortDir=${sortField == 'status' ? reverseSortDir : sortDir})}">
                                            Status <span th:if="${sortField == 'status'}"
                                                th:text="${sortDir == 'asc' ? '▲' : '▼'}"></span>
                                        </a>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="row : ${report}">
                                    <td>
                                        <span th:text="${row.employeeName}" class="fw-bold">John Doe</span>
                                        <small class="text-muted d-block" th:text="'ID: ' + ${row.employeeId}">ID:
                                            1</small>
                                    </td>
                                    <td th:text="${row.departmentName}">IT</td>
                                    <td th:text="${row.inTime != null ? row.inTime : '-'}">09:00</td>
                                    <td th:text="${row.outTime != null ? row.outTime : '-'}">18:00</td>
                                    <td>
                                        <span class="badge" th:classappend="'bg-' + ${row.statusColor}"
                                            th:text="${row.status}">PRESENT</span>
                                    </td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(report)}">
                                    <td colspan="5" class="text-center">No data found for this date.</td>
                                </tr>
                            </tbody>
                        </table>
                        <div th:replace="~{fragments/pagination :: pagination(page=${page}, baseUrl='/reports')}"></div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>

</html>